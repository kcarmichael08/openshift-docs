:_content-type: ASSEMBLY
[id="manage-network-policies"]
= Managing network policies
include::modules/common-attributes.adoc[]
:context: manage-network-policies

toc::[]

[role="_abstract"]
A https://kubernetes.io/docs/concepts/services-networking/network-policies/[Kubernetes network policy] is a specification of how groups of pods are allowed to communicate with each other and other network endpoints.
These network policies are configured as YAML files.
By looking at these files alone, it is often hard to identify whether the applied network policies achieve the desired network topology.

{rh-rhacs-first} gathers all defined network policies from your orchestrator and provides tools to make these policies easier to use.

To support network policy enforcement, {product-title-short} provides the following tools:

* Network graph
* Network policy generator
* Network policy simulator
* Build-time network policy generator

[id="network-graph-20-docs"]
== Network graph

include::modules/network-graph-20-view.adoc[leveloffset=+2]

include::modules/rbac-for-network-graph.adoc[leveloffset=+2]

.Additional resources
* xref:../operating/manage-user-access/manage-role-based-access-control-3630.adoc#rbac-permission-sets_manage-role-based-access-control[System permission sets]

include::modules/view-deployment-info.adoc[leveloffset=+2]

include::modules/view-network-policies-ng20.adoc[leveloffset=+2]

include::modules/configure-cidr-blocks-ng20.adoc[leveloffset=+2]

[id="network-graph-simulate-generate"]
== Using the network graph to generate and simulate network policies

include::modules/policy-generation-strategy-ng20.adoc[leveloffset=+2]

include::modules/generate-network-policies-ng20.adoc[leveloffset=+2]

include::modules/save-generated-policies-ng20.adoc[leveloffset=+2]

include::modules/test-generated-policies-ng20.adoc[leveloffset=+2]

include::modules/delete-generated-policies-ng20.adoc[leveloffset=+2]

include::modules/delete-all-autogenerated-policies-ng20.adoc[leveloffset=+2]

include::modules/simulate-network-policies-ng20.adoc[leveloffset=+2]

[role="_additional-resources"]
.Additional resources
* xref:../configuration/enable-offline-mode.adoc#update-kernel-support-packages_enable-offline-mode[Updating kernel support packages in offline mode]
* xref:../integration/integrate-using-generic-webhooks.adoc#integrate-using-generic-webhooks[Integrating using generic webhooks]

//About network baselining in the network graph
include::modules/use-network-baselining-ng20.adoc[leveloffset=+1]

include::modules/view-network-baselines-ng20.adoc[leveloffset=+2]

include::modules/download-network-baselines.adoc[leveloffset=+2]

include::modules/enable-alert-on-baseline-violations-ng20.adoc[leveloffset=+2]

//About build time network policy tools
[id="about-build-time-network-policy-tools_{context}"]
== About build time network policy tools

Build time network policy tools let you automate the creation and validation of Kubernetes network policies in your development and operations workflows using the `roxctl` CLI. These tools work with a specified file directory containing your project's workload and network policy manifests and do not require {product-title-short} authentication.

.Network policy tools
[%autowidth]
|===
| *Command* | *Description*

|`roxctl netpol generate`
|Generates Kubernetes network policies by analyzing your project's YAML manifests in a specified directory. The previous syntax was `roxctl generate netpol`. For more information, see xref:../operating/manage-network-policies.adoc#using-the-build-time-network-policy-generator[Using the build-time network policy generator].

|`roxctl netpol connectivity map`
|Lists the allowed connections between workloads in your project directory by examining the workload and Kubernetes network policy manifests. Additionally, a graphical representation in `.dot` format is included. For more information, see xref:../operating/manage-network-policies.adoc#connectivity-mapping-using-the-roxctl-connectivity-map-command_manage-network-policies[Connectivity mapping using the roxctl connectivity-map command].

|`roxctl netpol connectivity diff`
|Creates a list of variations in the allowed connections between two project versions. This is determined by the workload and Kubernetes network policy manifests in each version's directory. You can view the semantic differences, which might not be immediately obvious, in a syntactic difference output. For more information, see xref:../operating/manage-network-policies.adoc#identifying-the-differences-in-allowed-connections-between-project-versions_manage-network-policies[Identifying the differences in allowed connections between project versions].

|===

=== Using the build-time network policy generator
:FeatureName: Build-time network policy generation
include::snippets/technology-preview.adoc[]

The build-time network policy generator can automatically generate Kubernetes network policies based on application YAML manifests. You can use it to develop network policies as part of the continuous integration/continuous deployment (CI/CD) pipeline before deploying applications on your cluster.

Red Hat developed this feature in partnership with the developers of the link:https://np-guard.github.io/[NP-Guard project].
First, the build-time network policy generator analyzes Kubernetes manifests in a local folder, including service manifests, config maps, and workload manifests such as `Pod`, `Deployment`, `ReplicaSet`, `Job`, `DaemonSet`, and `StatefulSet`.
Then, it discovers the required connectivity and creates the Kubernetes network policies to achieve pod isolation.
These policies allow no more and no less than the needed ingress and egress traffic.

include::modules/generate-build-time-network-policies.adoc[leveloffset=+3]

After generating the policies, you must inspect them for completeness and accuracy, in case any relevant network address was not specified as expected in the YAML files.
Most importantly, verify that required connections are not blocked by the isolating policies. To help with this inspection, you can use {product-title-short} to  simulate the generated network policies .

[NOTE]
====
Applying network policies to the cluster as part of the workload deployment using automation saves time and ensures accuracy.
You can follow a GitOps approach by submitting the generated policies using Pull Requests, providing the team an opportunity to review the policies before deploying them as part of the pipeline.
====

include::modules/connectivity-mapping-using-the-roxctl-connectivity-map-command.adoc[leveloffset=+2]

include::modules/identifying-the-differences-in-allowed-connections-between-project-versions.adoc[leveloffset=+2]